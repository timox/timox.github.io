<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Tableau Kanban SSIR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <style>
    /* === Styles Kanban d'origine V9.16 === */
    :root {
      --kanban-bg: #f8f9fa;
      --kanban-card-bg: #ffffff;
      --kanban-border: #dee2e6;
      --kanban-text: #212529;
      --kanban-text-muted: #6c757d;
      --kanban-shadow: 0 2px 4px rgba(0,0,0,0.1);
      --kanban-shadow-hover: 0 4px 8px rgba(0,0,0,0.15);
      --kanban-border-radius: 8px;
      --kanban-transition: all 0.2s ease;
    }
    body {
      background-color: var(--kanban-bg);
      color: var(--kanban-text);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      transition: var(--kanban-transition);
    }
    .kanban-header {
      background: var(--kanban-card-bg);
      border-bottom: 1px solid var(--kanban-border);
      padding: 1rem 0;
      margin-bottom: 1rem;
      box-shadow: var(--kanban-shadow);
    }
    .kanban-controls {
      background: var(--kanban-card-bg);
      border-radius: var(--kanban-border-radius);
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: var(--kanban-shadow);
      border: 1px solid var(--kanban-border);
    }
    .kanban-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1rem;
      padding: 0 1rem;
    }
    .kanban-board {
      background: var(--kanban-card-bg);
      border-radius: var(--kanban-border-radius);
      border: 1px solid var(--kanban-border);
      box-shadow: var(--kanban-shadow);
      transition: var(--kanban-transition);
      min-height: 200px;
    }
    .kanban-board-header {
      padding: 1rem;
      border-bottom: 1px solid var(--kanban-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
    }
    .board-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .board-count {
      background: var(--kanban-text-muted);
      color: var(--kanban-card-bg);
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 500;
    }
    .kanban-board-body {
      padding: 1rem;
      min-height: 150px;
    }
    .kanban-item {
      background: var(--kanban-card-bg);
      border: 1px solid var(--kanban-border);
      border-radius: var(--kanban-border-radius);
      padding: 1rem;
      margin-bottom: 0.75rem;
      cursor: grab;
      transition: var(--kanban-transition);
      box-shadow: var(--kanban-shadow);
    }
    .kanban-item:hover {
      box-shadow: var(--kanban-shadow-hover);
      transform: translateY(-1px);
    }
    .kanban-item:active {
      cursor: grabbing;
    }
    .kanban-item.sortable-ghost {
      opacity: 0.4;
    }
    .kanban-item.sortable-chosen {
      transform: rotate(2deg);
    }
    .kanban-item.sortable-drag {
      transform: rotate(5deg);
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }
    .item-title {
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--kanban-text);
    }
    .item-description {
      font-size: 0.875rem;
      color: var(--kanban-text-muted);
      margin-bottom: 0.75rem;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .item-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .item-badges {
      display: flex;
      gap: 0.25rem;
      flex-wrap: wrap;
    }
    .priority-badge {
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      border-radius: 12px;
      font-weight: 500;
    }
    .priority-immediate { background-color: #dc3545; color: white; }
    .priority-courte { background-color: #fd7e14; color: white; }
    .priority-moyenne { background-color: #ffc107; color: #000; }
    .priority-longue { background-color: #198754; color: white; }
    .impact-badge {
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      border-radius: 12px;
      font-weight: 500;
    }
    .impact-critique { background-color: #dc3545; color: white; }
    .impact-important { background-color: #fd7e14; color: white; }
    .impact-modéré { background-color: #0dcaf0; color: #000; }
    .impact-mineur { background-color: #6c757d; color: white; }
    .item-assignees {
      display: flex;
      gap: 0.25rem;
    }
    .assignee-avatar {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: linear-gradient(45deg, #007bff, #6f42c1);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 500;
    }
    .board-backlog { border-top: 4px solid #6c757d; }
    .board-a-faire { border-top: 4px solid #0dcaf0; }
    .board-en-cours { border-top: 4px solid #fd7e14; }
    .board-en-attente { border-top: 4px solid #ffc107; }
    .board-bloque { border-top: 4px solid #dc3545; }
    .board-validation { border-top: 4px solid #6f42c1; }
    .board-termine { border-top: 4px solid #198754; }
    .board-hidden { display: none; }
    .modal-content {
      background-color: var(--kanban-card-bg);
      border: 1px solid var(--kanban-border);
      color: var(--kanban-text);
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.18);
    }
    .modal-header {
      background: linear-gradient(135deg, #6f42c1, #007bff);
      color: white;
      border-radius: 16px 16px 0 0;
      padding: 1.5rem;
    }
    .modal-footer {
      background: #f8f9fa;
      border-radius: 0 0 16px 16px;
    }
    /* Ajout pour délai */
    .delai-indicator {
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.85rem;
      display: inline-flex;
      align-items: center;
      margin-top: 0.5rem;
    }
    .delai-depasse { background: #ffe3e3; color: #dc3545; }
    .delai-urgent { background: #fff3cd; color: #fd7e14; }
    .delai-ok { background: #d4edda; color: #28a745; }
    .kanban-item {
  position: relative;
}
.drag-handle {
  position: absolute;
  left: 8px;
  top: 8px;
  cursor: grab;
  color: #888;
  z-index: 2;
  font-size: 1.2em;
  opacity: 0.7;
}
.drag-handle:hover {
  color: #333;
  opacity: 1;
}
.editable-zone {
  margin-left: 32px; /* Pour ne pas passer sous la poignée */
  cursor: pointer;
}
.priority-badge.priority-1 {
  background: #dc3545; /* rouge */
  color: #fff;
}
.priority-badge.priority-2 {
  background: #fd7e14; /* orange */
  color: #fff;
}
.priority-badge.priority-3 {
  background: #ffe066; /* jaune pâle */
  color: #333;
}
.priority-badge.priority-4 {
  background: #f8f9fa; /* blanc cassé */
  color: #333;
  border: 1px solid #e0e0e0;
}
.priority-badge {
  font-size: 1em;
  padding: 0.3em 0.8em;
  border-radius: 1.1em;
  font-weight: bold;
  margin-right: 0.5em;
  display: inline-block;
}
.desc-resume {
  color: #bbb;
  font-size: 0.93em;
  font-style: italic;
  font-weight: 400;
  opacity: 0.7;
  margin-bottom: 0.3em;
}
.modal-xl {
  max-width: 1100px;
}
.input-group > .form-control, .input-group > .form-select {
  min-width: 0;
}
.priority-badge.priority-1 { background: #dc3545; color: #fff; }
.priority-badge.priority-2 { background: #fd7e14; color: #fff; }
.priority-badge.priority-3 { background: #ffe066; color: #333; }
.priority-badge.priority-4 { background: #f8f9fa; color: #333; border: 1px solid #e0e0e0; }
.priority-badge {
  font-size: 1em;
  padding: 0.3em 0.8em;
  border-radius: 1.1em;
  font-weight: bold;
  margin-right: 0.5em;
  display: inline-block;
}
 .kanban-item {
  background: #f7fafd; /* bleu très pâle */
  border: 1px solid #e0e6ef;
  border-radius: 10px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.04);
  margin-bottom: 1.2em;
  padding: 1.1em 1em 0.8em 1em;
  min-height: 120px;
  position: relative;
  transition: box-shadow 0.15s;
}
.kanban-item:hover {
  box-shadow: 0 4px 16px rgba(0,0,0,0.07);
}
.kanban-item-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 0.7em;
}
.priority-badge.priority-1 { background: #dc3545; color: #fff; }
.priority-badge.priority-2 { background: #fd7e14; color: #fff; }
.priority-badge.priority-3 { background: #ffe066; color: #333; }
.priority-badge.priority-4 { background: #f8f9fa; color: #333; border: 1px solid #e0e0e0; }
.priority-badge {
  font-size: 1em;
  padding: 0.32em 1.1em;
  border-radius: 1.2em;
  font-weight: bold;
  margin-right: 0.5em;
  display: inline-block;
  box-shadow: 0 1px 2px rgba(0,0,0,0.04);
}
.projet-badge {
  color: #222;
  border-radius: 1em;
  padding: 0.26em 0.8em;
  font-size: 0.95em;
  font-weight: 500;
  margin-left: 0.4em;
  cursor: pointer;
  white-space: nowrap;
  border: 1px solid #e0e0e0;
  box-shadow: 0 1px 2px rgba(0,0,0,0.04);
}
.desc-resume {
  color: #a5a5a5;
  font-size: 0.97em;
  font-style: italic;
  font-weight: 400;
  opacity: 0.8;
  margin-bottom: 0.3em;
  margin-top: 0.2em;
}
.personnes-list {
  margin-top: 0.5em;
}
.personne-badge {
  display: inline-block;
  background: #d1e7dd;
  color: #17644e;
  border-radius: 1em;
  padding: 0.2em 0.7em;
  font-size: 0.92em;
  margin-right: 0.3em;
  margin-bottom: 0.2em;
}
 .projet-badge {
  color: #222;
  border-radius: 1em;
  padding: 0.26em 0.8em;
  font-size: 0.95em;
  font-weight: 500;
  margin-left: 0.4em;
  cursor: pointer;
  white-space: nowrap;
  border: 1px solid #e0e0e0;
}

#strategie-objectif, #strategie-sous-objectif, #strategie-action {
  min-width: 170px;
  max-width: 220px;
  font-size: 1em;
}
.input-group.mb-2.flex-nowrap {
  gap: 0.5em;
}

/* === AMÉLIORATIONS CSS POUR LE DRAG & DROP === */
/* Ajoutez ces styles à votre CSS existant */

/* Amélioration de la poignée de drag */
.drag-handle {
  position: absolute;
  left: 8px;
  top: 8px;
  cursor: grab;
  color: #888;
  z-index: 10; /* Plus élevé pour éviter les conflits */
  font-size: 1.2em;
  opacity: 0.7;
  transition: all 0.2s ease;
  padding: 4px;
  border-radius: 4px;
}

.drag-handle:hover {
  color: #333;
  opacity: 1;
  background-color: rgba(0,0,0,0.05);
}

.drag-handle:active {
  cursor: grabbing;
}

/* Amélioration de la zone éditable */
.editable-zone {
  margin-left: 32px; /* Pour ne pas passer sous la poignée */
  cursor: pointer;
  padding: 2px 4px;
  border-radius: 4px;
  transition: background-color 0.2s ease;
}

.editable-zone:hover {
  background-color: rgba(0,123,255,0.05);
}

/* Amélioration des états de drag */
.kanban-item {
  position: relative;
  transition: all 0.2s ease;
  cursor: default; /* Curseur par défaut, sauf sur la poignée */
}

.kanban-item.sortable-ghost {
  opacity: 0.3;
  background-color: #e9ecef;
  transform: rotate(0deg);
}

.kanban-item.sortable-chosen {
  transform: rotate(2deg);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  z-index: 1000;
}

.kanban-item.sortable-drag {
  transform: rotate(5deg);
  box-shadow: 0 8px 20px rgba(0,0,0,0.25);
  opacity: 0.9;
}

/* Amélioration des zones de drop */
.kanban-board-body {
  min-height: 200px;
  transition: background-color 0.2s ease;
}

.kanban-board-body.sortable-drag-over {
  background-color: rgba(0,123,255,0.05);
  border: 2px dashed #007bff;
  border-radius: 8px;
}

/* Amélioration visuelle pendant le drag */
.kanban-container.dragging .kanban-board {
  transition: all 0.2s ease;
}

.kanban-container.dragging .kanban-board:hover {
  background-color: rgba(0,123,255,0.02);
}

/* Indicateur visuel pour les zones de drop valides */
.drop-zone-active {
  background-color: rgba(40, 167, 69, 0.1);
  border: 2px dashed #28a745;
}

.drop-zone-invalid {
  background-color: rgba(220, 53, 69, 0.1);
  border: 2px dashed #dc3545;
}

/* Responsive - masquer la poignée sur mobile */
@media (max-width: 768px) {
  .drag-handle {
    display: none;
  }
  
  .editable-zone {
    margin-left: 0;
  }
  
  .kanban-item {
    cursor: grab;
  }
  
  .kanban-item:active {
    cursor: grabbing;
  }
}
/* === CSS SIMPLIFIÉ POUR LES DATES === */
/* À ajouter dans la section <style> de votre index.html */

/* Conteneur des dates */
.dates-container {
  margin-top: 0.5em;
  margin-bottom: 0.3em;
  display: flex;
  flex-direction: column;
  gap: 0.2em;
}

/* Styles de base pour les dates */
.date-debut, .date-echeance {
  display: inline-flex;
  align-items: center;
  gap: 0.3em;
  padding: 0.2em 0.5em;
  border-radius: 0.8em;
  font-size: 0.85em;
  font-weight: 500;
  white-space: nowrap;
}

/* Date de début */
.date-debut {
  background: #e3f2fd;
  color: #1565c0;
  border: 1px solid #bbdefb;
}

/* === CSS SIMPLIFIÉ POUR LES DATES === */
/* À ajouter dans la section <style> de votre index.html */

/* Conteneur des dates */
.dates-container {
  margin-top: 0.5em;
  margin-bottom: 0.3em;
  display: flex;
  flex-direction: column;
  gap: 0.2em;
}

/* Styles de base pour les dates */
.date-debut, .date-echeance {
  display: inline-flex;
  align-items: center;
  gap: 0.3em;
  padding: 0.2em 0.5em;
  border-radius: 0.8em;
  font-size: 0.85em;
  font-weight: 500;
  white-space: nowrap;
}

/* Date de début */
.date-debut {
  background: #e3f2fd;
  color: #1565c0;
  border: 1px solid #bbdefb;
}
/* === CSS SIMPLIFIÉ POUR LES DATES === */
/* À ajouter dans la section <style> de votre index.html */

/* Conteneur des dates */
.dates-container {
  margin-top: 0.5em;
  margin-bottom: 0.3em;
  display: flex;
  flex-direction: column;
  gap: 0.2em;
}

/* Styles de base pour les dates */
.date-debut, .date-echeance {
  display: inline-flex;
  align-items: center;
  gap: 0.3em;
  padding: 0.2em 0.5em;
  border-radius: 0.8em;
  font-size: 0.85em;
  font-weight: 500;
  white-space: nowrap;
}

/* Date de début */
.date-debut {
  background: #e3f2fd;
  color: #1565c0;
  border: 1px solid #bbdefb;
}

/* Date d'échéance - SIMPLIFIÉ : toujours icône rouge mais couleurs différentes */
.date-echeance {
  color: #dc3545; /* Toujours rouge pour l'icône */
}

.date-echeance.echeance-ok {
  background: #e8f5e8;
  border: 1px solid #c8e6c9;
}

.date-echeance.echeance-bientot {
  background: #fff3e0;
  border: 1px solid #ffcc02;
}

.date-echeance.echeance-urgent {
  background: #fff3e0;
  border: 1px solid #ffb74d;
  animation: pulse-orange 2s infinite;
}

.date-echeance.echeance-aujourd-hui {
  background: #fff8e1;
  border: 1px solid #ffcc02;
  font-weight: bold;
  animation: pulse-yellow 2s infinite;
}

.date-echeance.echeance-depassee {
  background: #ffebee;
  border: 1px solid #ef9a9a;
  font-weight: bold;
  animation: pulse-red 2s infinite;
}

/* Animations pour attirer l'attention */
@keyframes pulse-red {
  0%, 100% { background: #ffebee; }
  50% { background: #ffcdd2; }
}

@keyframes pulse-yellow {
  0%, 100% { background: #fff8e1; }
  50% { background: #fff3c4; }
}

@keyframes pulse-orange {
  0%, 100% { background: #fff3e0; }
  50% { background: #ffe0b2; }
}

/* Classes pour les cartes avec dates */
.kanban-item.has-echeance {
  border-left: 3px solid #2e7d32; /* Vert par défaut */
}

.kanban-item.has-echeance:has(.echeance-urgent) {
  border-left: 3px solid #e65100; /* Orange pour urgent */
}

.kanban-item.has-echeance:has(.echeance-aujourd-hui) {
  border-left: 3px solid #ff8f00; /* Jaune pour aujourd'hui */
}

.kanban-item.has-echeance:has(.echeance-depassee) {
  border-left: 3px solid #c62828; /* Rouge pour dépassé */
}

.kanban-item.has-debut:not(.has-echeance) {
  position: relative;
}

/* Point bleu seulement si on a à la fois début ET échéance */
.kanban-item.has-debut.has-echeance::before {
  content: '';
  position: absolute;
  top: 8px;
  right: 8px;
  width: 8px;
  height: 8px;
  background: #1565c0;
  border-radius: 50%;
  opacity: 0.7;
}

/* Hover effects */
.date-debut:hover, .date-echeance:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  transition: all 0.2s ease;
}

/* Responsive pour mobile */
@media (max-width: 768px) {
  .dates-container {
    font-size: 0.8em;
  }
  
  .date-debut, .date-echeance {
    padding: 0.15em 0.4em;
    font-size: 0.8em;
  }
}

/* Amélioration des icônes dans les dates */
.date-debut i, .date-echeance i {
  font-size: 0.9em;
}

/* Masquer le sélecteur de type de délai */
#delai-type {
  display: none !important;
}

/* Améliorer le champ de date */
#popup-delai {
  border-radius: 6px;
  border: 1px solid #ced4da;
  padding: 0.5rem;
}

#popup-delai:focus {
  border-color: #80bdff;
  box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}


/* === CSS SIMPLIFIÉ POUR LES DATES === */

/* Conteneur des dates */
.dates-container {
  margin-top: 0.5em;
  margin-bottom: 0.3em;
  display: flex;
  flex-direction: column;
  gap: 0.2em;
}

/* Styles de base pour les dates */
.date-debut, .date-echeance {
  display: inline-flex;
  align-items: center;
  gap: 0.3em;
  padding: 0.2em 0.5em;
  border-radius: 0.8em;
  font-size: 0.85em;
  font-weight: 500;
  white-space: nowrap;
}

/* Date de début */
.date-debut {
  background: #e3f2fd;
  color: #1565c0;
  border: 1px solid #bbdefb;
}

/* Date d'échéance - SIMPLIFIÉ : toujours icône rouge mais couleurs différentes */
.date-echeance {
  color: #dc3545; /* Toujours rouge pour l'icône */
}

.date-echeance.echeance-ok {
  background: #e8f5e8;
  border: 1px solid #c8e6c9;
}

.date-echeance.echeance-bientot {
  background: #fff3e0;
  border: 1px solid #ffcc02;
}

.date-echeance.echeance-urgent {
  background: #fff3e0;
  border: 1px solid #ffb74d;
  animation: pulse-orange 2s infinite;
}

.date-echeance.echeance-aujourd-hui {
  background: #fff8e1;
  border: 1px solid #ffcc02;
  font-weight: bold;
  animation: pulse-yellow 2s infinite;
}

.date-echeance.echeance-depassee {
  background: #ffebee;
  border: 1px solid #ef9a9a;
  font-weight: bold;
  animation: pulse-red 2s infinite;
}

/* Animations pour attirer l'attention */
@keyframes pulse-red {
  0%, 100% { background: #ffebee; }
  50% { background: #ffcdd2; }
}

@keyframes pulse-yellow {
  0%, 100% { background: #fff8e1; }
  50% { background: #fff3c4; }
}

@keyframes pulse-orange {
  0%, 100% { background: #fff3e0; }
  50% { background: #ffe0b2; }
}

/* Classes pour les cartes avec dates */
.kanban-item.has-echeance {
  border-left: 3px solid #2e7d32; /* Vert par défaut */
}

.kanban-item.has-echeance:has(.echeance-urgent) {
  border-left: 3px solid #e65100; /* Orange pour urgent */
}

.kanban-item.has-echeance:has(.echeance-aujourd-hui) {
  border-left: 3px solid #ff8f00; /* Jaune pour aujourd'hui */
}

.kanban-item.has-echeance:has(.echeance-depassee) {
  border-left: 3px solid #c62828; /* Rouge pour dépassé */
}

.kanban-item.has-debut:not(.has-echeance) {
  position: relative;
}

/* Point bleu seulement si on a à la fois début ET échéance */
.kanban-item.has-debut.has-echeance::before {
  content: '';
  position: absolute;
  top: 8px;
  right: 8px;
  width: 8px;
  height: 8px;
  background: #1565c0;
  border-radius: 50%;
  opacity: 0.7;
}

/* Hover effects */
.date-debut:hover, .date-echeance:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  transition: all 0.2s ease;
}

/* Responsive pour mobile */
@media (max-width: 768px) {
  .dates-container {
    font-size: 0.8em;
  }
  
  .date-debut, .date-echeance {
    padding: 0.15em 0.4em;
    font-size: 0.8em;
  }
}

/* Amélioration des icônes dans les dates */
.date-debut i, .date-echeance i {
  font-size: 0.9em;
}

/* Masquer le sélecteur de type de délai */
#delai-type {
  display: none !important;
}

/* Améliorer le champ de date */
#popup-delai {
  border-radius: 6px;
  border: 1px solid #ced4da;
  padding: 0.5rem;
}

#popup-delai:focus {
  border-color: #80bdff;
  box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

/* === CSS POUR LES MODES DE VUE === */

/* Contrôles de mode de vue */
.btn-group .btn {
  font-size: 0.875rem;
  padding: 0.375rem 0.75rem;
}

.btn-group .btn.active {
  background-color: #007bff;
  border-color: #007bff;
  color: white;
}

/* Mode Compact */
.kanban-container.kanban-compact {
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
}

.kanban-compact .kanban-board-body {
  max-height: 400px;
  overflow-y: auto;
  scrollbar-width: thin;
}

.kanban-compact .kanban-board-body::-webkit-scrollbar {
  width: 6px;
}

.kanban-compact .kanban-board-body::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 6px;
}

.kanban-compact .kanban-board-body::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 6px;
}

/* Cartes compactes */
.kanban-item-compact {
  padding: 0.75rem;
  margin-bottom: 0.5rem;
  min-height: auto;
  background: #ffffff;
  border: 1px solid #e0e6ef;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.04);
  transition: all 0.2s ease;
}

.kanban-item-compact:hover {
  box-shadow: 0 3px 12px rgba(0,0,0,0.1);
  transform: translateY(-1px);
}

.compact-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.5rem;
}

.compact-priority {
  flex-shrink: 0;
}

.compact-echeance {
  flex-grow: 1;
  text-align: center;
}

.date-echeance-compact {
  font-size: 0.75rem;
  padding: 0.2rem 0.4rem;
  border-radius: 0.5rem;
  display: inline-flex;
  align-items: center;
  gap: 0.2rem;
  color: #dc3545;
}

.date-echeance-compact.echeance-ok {
  background: #e8f5e8;
  border: 1px solid #c8e6c9;
}

.date-echeance-compact.echeance-bientot {
  background: #fff3e0;
  border: 1px solid #ffcc02;
}

.date-echeance-compact.echeance-urgent {
  background: #fff3e0;
  border: 1px solid #ffb74d;
  animation: pulse-orange 2s infinite;
}

.date-echeance-compact.echeance-aujourd-hui {
  background: #fff8e1;
  border: 1px solid #ffcc02;
  font-weight: bold;
  animation: pulse-yellow 2s infinite;
}

.date-echeance-compact.echeance-depassee {
  background: #ffebee;
  border: 1px solid #ef9a9a;
  font-weight: bold;
  animation: pulse-red 2s infinite;
}

.btn-expand, .btn-collapse {
  background: none;
  border: none;
  color: #6c757d;
  padding: 0.2rem;
  border-radius: 3px;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 0.8rem;
}

.btn-expand:hover, .btn-collapse:hover {
  color: #007bff;
  background: rgba(0,123,255,0.1);
}

.compact-title {
  font-weight: 600;
  font-size: 0.9rem;
  line-height: 1.3;
  cursor: pointer;
  padding: 2px 4px;
  border-radius: 4px;
  transition: background-color 0.2s ease;
}

.compact-title:hover {
  background-color: rgba(0,123,255,0.05);
}

/* Mode Focus */
.focus-navigation {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1rem;
  padding: 1rem;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  flex-wrap: wrap;
}

.focus-navigation .btn {
  border-radius: 20px;
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
  position: relative;
}

.focus-navigation .btn.active {
  background-color: #007bff;
  border-color: #007bff;
  color: white;
}

.focus-navigation .badge {
  margin-left: 0.5rem;
  font-size: 0.7rem;
}

.focus-column {
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  min-height: 500px;
}

.focus-column .kanban-board-header {
  padding: 1.5rem;
  border-bottom: 2px solid #e9ecef;
  font-size: 1.2rem;
  font-weight: 600;
}

.focus-column .kanban-board-body {
  padding: 1rem;
  max-height: 70vh;
  overflow-y: auto;
}

/* Mode Détaillé */
.kanban-container.kanban-detailed {
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
}

.kanban-detailed .kanban-board-body {
  max-height: none;
}

/* Améliorations des cartes détaillées */
.kanban-item-detailed {
  position: relative;
  background: #f7fafd;
  border: 1px solid #e0e6ef;
  border-radius: 10px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.04);
  margin-bottom: 1rem; /* Réduction de l'espacement */
  padding: 1rem;
  min-height: 100px; /* Réduction de la hauteur minimale */
  transition: box-shadow 0.15s;
  width: 100%; /* Assure que les cartes prennent toute la largeur de leur cellule de grille */
}

.kanban-item-detailed:hover {
  box-shadow: 0 4px 16px rgba(0,0,0,0.07);
}

/* Style spécial pour les headers de colonnes en mode détaillé */
.kanban-detailed .board-title {
  font-size: 1.1rem;
  color: #495057;
}

.kanban-detailed .board-count {
  background: #6c757d;
  color: white;
  padding: 0.25rem 0.5rem;
  border-radius: 12px;
  font-size: 0.875rem;
  min-width: 24px;
  text-align: center;
}

/* Amélioration visuelle des bordures par statut en mode détaillé */
.kanban-detailed .board-backlog .kanban-board-header { border-left: 4px solid #6c757d; }
.kanban-detailed .board-a-faire .kanban-board-header { border-left: 4px solid #0dcaf0; }
.kanban-detailed .board-en-cours .kanban-board-header { border-left: 4px solid #fd7e14; }
.kanban-detailed .board-en-attente .kanban-board-header { border-left: 4px solid #ffc107; }
.kanban-detailed .board-bloque .kanban-board-header { border-left: 4px solid #dc3545; }
.kanban-detailed .board-validation .kanban-board-header { border-left: 4px solid #6f42c1; }
.kanban-detailed .board-termine .kanban-board-header { border-left: 4px solid #198754; }

/* Responsive */
@media (max-width: 768px) {
  .kanban-container.kanban-compact {
    grid-template-columns: 1fr;
  }
  
  .kanban-compact .kanban-board-body {
    max-height: calc(100vh - 280px); /* Plus d'espace sur mobile */
  }
  
  .kanban-detailed .kanban-board-body {
    grid-template-columns: 1fr; /* Une seule colonne sur mobile */
  }
  
  .focus-navigation {
    padding: 0.5rem;
  }
  
  .focus-navigation .btn {
    font-size: 0.75rem;
    padding: 0.4rem 0.8rem;
  }
  
  .compact-header {
    flex-direction: column;
    gap: 0.3rem;
    align-items: flex-start;
  }
  
  .compact-echeance {
    text-align: left;
  }
}

/* === CSS SIMPLIFIÉ POUR LES DATES === */

/* Conteneur des dates */
.dates-container {
  margin-top: 0.5em;
  margin-bottom: 0.3em;
  display: flex;
  flex-direction: column;
  gap: 0.2em;
}

/* Styles de base pour les dates */
.date-debut, .date-echeance {
  display: inline-flex;
  align-items: center;
  gap: 0.3em;
  padding: 0.2em 0.5em;
  border-radius: 0.8em;
  font-size: 0.85em;
  font-weight: 500;
  white-space: nowrap;
}

/* Date de début */
.date-debut {
  background: #e3f2fd;
  color: #1565c0;
  border: 1px solid #bbdefb;
}

/* Date d'échéance - SIMPLIFIÉ : toujours icône rouge mais couleurs différentes */
.date-echeance {
  color: #dc3545; /* Toujours rouge pour l'icône */
}

.date-echeance.echeance-ok {
  background: #e8f5e8;
  border: 1px solid #c8e6c9;
}

.date-echeance.echeance-bientot {
  background: #fff3e0;
  border: 1px solid #ffcc02;
}

.date-echeance.echeance-urgent {
  background: #fff3e0;
  border: 1px solid #ffb74d;
  animation: pulse-orange 2s infinite;
}

.date-echeance.echeance-aujourd-hui {
  background: #fff8e1;
  border: 1px solid #ffcc02;
  font-weight: bold;
  animation: pulse-yellow 2s infinite;
}

.date-echeance.echeance-depassee {
  background: #ffebee;
  border: 1px solid #ef9a9a;
  font-weight: bold;
  animation: pulse-red 2s infinite;
}

/* Animations pour attirer l'attention */
@keyframes pulse-red {
  0%, 100% { background: #ffebee; }
  50% { background: #ffcdd2; }
}

@keyframes pulse-yellow {
  0%, 100% { background: #fff8e1; }
  50% { background: #fff3c4; }
}

@keyframes pulse-orange {
  0%, 100% { background: #fff3e0; }
  50% { background: #ffe0b2; }
}

/* Classes pour les cartes avec dates */
.kanban-item.has-echeance {
  border-left: 3px solid #2e7d32; /* Vert par défaut */
}

.kanban-item.has-echeance:has(.echeance-urgent) {
  border-left: 3px solid #e65100; /* Orange pour urgent */
}

.kanban-item.has-echeance:has(.echeance-aujourd-hui) {
  border-left: 3px solid #ff8f00; /* Jaune pour aujourd'hui */
}

.kanban-item.has-echeance:has(.echeance-depassee) {
  border-left: 3px solid #c62828; /* Rouge pour dépassé */
}

.kanban-item.has-debut:not(.has-echeance) {
  position: relative;
}

/* Point bleu seulement si on a à la fois début ET échéance */
.kanban-item.has-debut.has-echeance::before {
  content: '';
  position: absolute;
  top: 8px;
  right: 8px;
  width: 8px;
  height: 8px;
  background: #1565c0;
  border-radius: 50%;
  opacity: 0.7;
}

/* Hover effects */
.date-debut:hover, .date-echeance:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  transition: all 0.2s ease;
}

/* Responsive pour mobile */
@media (max-width: 768px) {
  .dates-container {
    font-size: 0.8em;
  }
  
  .date-debut, .date-echeance {
    padding: 0.15em 0.4em;
    font-size: 0.8em;
  }
}

/* Amélioration des icônes dans les dates */
.date-debut i, .date-echeance i {
  font-size: 0.9em;
}

/* Masquer le sélecteur de type de délai */
#delai-type {
  display: none !important;
}

/* Améliorer le champ de date */
#popup-delai {
  border-radius: 6px;
  border: 1px solid #ced4da;
  padding: 0.5rem;
}

#popup-delai:focus {
  border-color: #80bdff;
  box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}
    
.task-card[data-niveau="objectif"] { border-left: 4px solid #e74c3c; }
.task-card[data-niveau="sous-objectif"] { border-left: 4px solid #f39c12; }
.task-card[data-niveau="action"] { border-left: 4px solid #27ae60; }
.task-card[data-niveau="orpheline"] { border-left: 4px solid #95a5a6; }



  </style>
</head>
<body>
  <div class="container-fluid">
    <div class="kanban-header">
      <div class="container-fluid">
        <div class="row align-items-center">
          <div class="col">
            <h1 class="h3 mb-0">
              <i class="bi bi-kanban me-2"></i>
              Tableau Kanban SSIR
            </h1>
          </div>
          <div class="col-auto">
            <button type="button" class="btn btn-primary" id="btn-nouvelle-tache" aria-label="Créer une nouvelle tâche">
              <i class="bi bi-plus-lg me-2"></i>Nouvelle Tâche
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="container-fluid">
      <div class="kanban-controls">
        <div class="row g-3 align-items-center">
          <div class="col-md-3">
            <input type="text" class="form-control" id="search-input" placeholder="Rechercher..." aria-label="Rechercher des tâches">
          </div>
          <div class="col-md-2">
            <select class="form-select" id="filter-bureau" aria-label="Filtrer par bureau"></select>
          </div>
          <div class="col-md-2">
            <select class="form-select" id="filter-qui" aria-label="Filtrer par responsable"></select>
          </div>
          <div class="col-md-2">
            <select class="form-select" id="filter-projet" aria-label="Filtrer par projet"></select>
          </div>
          <div class="col-md-2">
            <select class="form-select" id="filter-statut" aria-label="Filtrer par statut"></select>
          </div>
          <div class="col-md-1">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="show-termine" checked>
              <label class="form-check-label" for="show-termine">Terminés</label>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="error-container" role="alert" aria-live="polite"></div>
    <div class="loading-spinner" id="loading-spinner" style="display:none;">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Chargement...</span>
      </div>
      <p class="mt-2">Chargement du Kanban...</p>
    </div>
    <div class="container-fluid">
      <div id="kanban-container" class="kanban-container" role="main" aria-label="Tableau Kanban"></div>
    </div>
    <div class="keyboard-shortcuts">
      <div><kbd>N</kbd> Nouvelle tâche</div>
      <div><kbd>F</kbd> Focus recherche</div>
      <div><kbd>T</kbd> Basculer thème</div>
    </div>
  </div>
<!-- MODALE MODIFIÉE avec bouton supprimer - Remplacez la modale existante par ceci -->
<div class="modal fade" id="popup-tache" tabindex="-1" aria-labelledby="popup-tache-label" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="popup-tache-label">
          <i class="bi bi-card-checklist me-2"></i>Détails Tâche
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fermer"></button>
      </div>
      <div class="modal-body">
        <form id="task-form" novalidate>
          <div class="row g-3">
            <div class="col-12">
              <label for="popup-titre" class="form-label">Titre *</label>
              <input type="text" class="form-control" id="popup-titre" required>
            </div>
            <div class="col-12">
              <label for="popup-description" class="form-label">Description</label>
              <textarea class="form-control" id="popup-description" rows="3"></textarea>
            </div>
            <div class="col-md-4">
              <label for="popup-statut-text" class="form-label">Statut *</label>
              <input type="text" class="form-control" id="popup-statut-text" readonly required>
            </div>
            <div class="col-md-4">
              <label for="popup-projet" class="form-label">Projet</label>
              <div class="input-group">
                <select class="form-select" id="popup-projet"></select>
                <input type="text" class="form-control" id="projet-ajout" placeholder="Ajouter projet">
                <button class="btn btn-outline-secondary" type="button" id="btn-ajout-projet"><i class="bi bi-plus"></i></button>
              </div>
            </div>
            <div class="col-12">
              <label class="form-label">Stratégie</label>
              <div class="input-group flex-nowrap" style="gap:0.5em;">
                <select class="form-select" id="strategie-objectif" size="5" style="min-width:260px;"></select>
                <select class="form-select" id="strategie-sous-objectif" size="5" style="min-width:260px;"></select>
                <select class="form-select" id="strategie-action" size="5" style="min-width:260px;"></select>
              </div>
            </div>
            <div class="col-md-6">
              <label class="form-label">Urgence & Impact</label>
              <div class="input-group">
                <select class="form-select" id="popup-urgence">
                  <option value="">-- Urgence --</option>
                </select>
                <select class="form-select" id="popup-impact">
                  <option value="">-- Impact --</option>
                </select>
              </div>
            </div>
            <div class="col-md-6">
              <label class="form-label"><i class="bi bi-calendar-event me-2"></i>Délai / Date butoir</label>
              <div class="input-group">
                <select class="form-select" id="delai-type" style="max-width: 120px;">
                  <option value="date">Date fixe</option>
                  <option value="semaines">Semaines</option>
                  <option value="mois">Mois</option>
                </select>
                <input type="text" class="form-control" id="popup-delai" placeholder="Sélectionner..." aria-label="Délai">
              </div>
            </div>
            <div class="col-md-6">
              <label for="popup-bureau" class="form-label">Bureaux</label>
              <select class="form-select" id="popup-bureau" multiple size="4"></select>
              <div class="form-text">Maintenez Ctrl pour sélectionner plusieurs bureaux</div>
            </div>
            <div class="col-md-6">
              <label for="popup-qui" class="form-label">Responsables</label>
              <select class="form-select" id="popup-qui" multiple size="4"></select>
              <div class="form-text">Maintenez Ctrl pour sélectionner plusieurs responsables</div>
            </div>
            <div class="row mt-3">
              <div class="col-12">
                <label class="form-label">Affectation</label>
                <div id="affectation-equipes"></div>
                <div id="affectation-personnes" class="mt-1"></div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <!-- NOUVEAU: Bouton supprimer à gauche -->
        <button type="button" class="btn btn-danger me-auto" id="btn-delete-task" style="display: none;">
          <i class="bi bi-trash me-2"></i>Supprimer
        </button>
        
        <!-- Boutons de contrôle à droite -->
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="bi bi-x-circle me-2"></i>Annuler
        </button>
        <button type="button" class="btn btn-primary" id="btn-save-task">
          <i class="bi bi-check2-circle me-2"></i>Sauvegarder
        </button>
      </div>
    </div>
  </div>
</div>
  
  <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/fr.js"></script>
  <script src="js.js"></script>
</body>
</html>
